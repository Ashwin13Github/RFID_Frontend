<div class="container">
  <!-- ================= TOP BAR ================= -->
  <div class="top-bar">
    <h2 class="heading" style="color: #007bff">Student Active Report</h2>

    <!-- PAGE SIZE DROPDOWN -->
    <div class="page-size-box">
      <label>Logs per page:</label>
      <select [(ngModel)]="itemsPerPage" (change)="changeItemsPerPage()">
        <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
      </select>
    </div>

    <!-- FILTER BUTTON -->
    <button class="filter-btn" (click)="openFilterPopup()">Filter</button>

    <!-- SORT BUTTON WITH DROPDOWN -->
    <div class="sort-wrapper">
      <button class="sort-btn" (click)="toggleSortDropdown()">Sort ⬍</button>

      <div class="sort-dropdown" *ngIf="showSortDropdown">
        <!-- Sort Column -->
        <div class="sort-column">
          <label>Sort Column:</label>
          <ul>
            <li *ngFor="let col of sortColumns" (click)="setSortColumn(col)">
              {{ col.label }}
              <span *ngIf="sortColumn === col.value">✔</span>
            </li>
          </ul>
        </div>

        <!-- Sort Direction -->
        <div class="sort-direction">
          <label>Direction:</label>
          <ul>
            <li (click)="setSortDirection('asc')">
              Ascending <span *ngIf="sortDirection === 'asc'">✔</span>
            </li>
            <li (click)="setSortDirection('desc')">
              Descending <span *ngIf="sortDirection === 'desc'">✔</span>
            </li>
          </ul>
        </div>

        <button class="apply-btn" (click)="applySorting(); closeSortDropdown()">Apply</button>
      </div>
    </div>
  </div>

  <!-- ================= FILTER POPUP ================= -->
  <div class="modal-backdrop" *ngIf="showFilterPopup"></div>
  <div class="popup-modal" *ngIf="showFilterPopup">
    <h3>Filter Logs</h3>
    <div class="form-group">
      <label>Location</label>
      <select [(ngModel)]="filterLocation">
        <option value="">All</option>
        <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Action</label>
      <select [(ngModel)]="filterAction">
        <option value="">All</option>
        <option value="Entry">Entry</option>
        <option value="Exit">Exit</option>
      </select>
    </div>

    <div class="form-group">
      <label>Designation</label>
      <input type="text" [(ngModel)]="filterDesignation" placeholder="Enter Designation" />
    </div>

    <div class="form-group">
      <label>Class/Department</label>
      <input type="text" [(ngModel)]="filterClassOrDept" placeholder="Enter Class or Department" />
    </div>

    <div class="form-group">
      <label>From Date</label>
      <input type="datetime-local" [(ngModel)]="filterFromDate" />
    </div>

    <div class="form-group">
      <label>To Date</label>
      <input type="datetime-local" [(ngModel)]="filterToDate" />
    </div>

    <div class="form-group">
      <label>UID / Name</label>
      <input type="text" [(ngModel)]="filterUidOrName" placeholder="Enter UID or Name" />
    </div>

    <div class="modal-actions">
      <button class="apply-btn" (click)="applyFilters()">Apply</button>
      <button class="close-btn" (click)="closeFilterPopup()">Close</button>
    </div>
  </div>

  <!-- ================= STATUS MESSAGES ================= -->
  <div class="status-message" *ngIf="isLoading">Loading logs...</div>
  <div class="status-message error" *ngIf="errorMessage">{{ errorMessage }}</div>

  <!-- ================= TABLE ================= -->
  <table *ngIf="!isLoading && paginatedLogs.length > 0" class="rfid-table">
    <thead>
      <tr>
        <th>UID</th>
        <th>Name</th>
        <th>Location</th>
        <th>Action</th>
        <th>Designation</th>
        <th>Class/Department</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let log of paginatedLogs">
        <td>{{ log.uid }}</td>
        <td>{{ log.fullName }}</td>
        <td>{{ log.location }}</td>
        <td>
          <span [ngClass]="log.action.toLowerCase()">{{ log.action }}</span>
        </td>
        <td>{{ log.designation }}</td>
        <td>{{ log.classOrDept }}</td>
        <td>{{ log.timestamp | date : 'MM/dd/yy, h:mm a' }}</td>
      </tr>
    </tbody>
  </table>

  <div class="no-logs" *ngIf="!isLoading && paginatedLogs.length == 0">No logs found.</div>

  <!-- ================= PAGINATION ================= -->
  <div class="pagination" *ngIf="!isLoading && filteredLogs.length > itemsPerPage">
    <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
    <button
      *ngFor="let page of totalPagesArray"
      [class.active]="page === currentPage"
      (click)="goToPage(page)"
    >
      {{ page }}
    </button>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>
